<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commands List</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Commands List</h1>
    <h2>Number of videos: {{ count }}</h2>
    <div class="action-buttons">
        <button onclick="openAddPopup()">Add</button>
        <button onclick="deleteSelected()">Delete Selected</button>
        <button onclick="clearAll()">Clear All</button>
        <button onclick="createCommand()">Create Command</button>
    </div>
    <hr>
    <ul>
        {% if cmds_queue %}
        {% for command in cmds_queue %}
        <li>
            <div>
                <strong>Video Name:</strong> {{ extract_save_name(command) }}
                <br>
                <strong>Video Type:</strong> {{ commandtype(command) }}
            </div>
            <div class="dropdown" onclick="toggleDropdown(event)">
                <span class="arrow">&#9660;</span>
                <div class="dropdown-content">
                    <button onclick="openShowPopup('{{ command }}')">Show Full Command</button>
                    <button onclick="showDeleteConfirmation({{ loop.index }})">Delete</button>
                </div>
            </div>
        </li>
        {% endfor %}
        {% else %}
        <li>No commands available. Add some!</li>
        {% endif %}
    </ul>

    <!-- Popups -->
    <div class="popup-overlay" id="add-popup">
        <div class="popup">
            <h2>Add Command</h2>
            <form method="POST" action="/addcmd">
                <input type="text" name="userinput" placeholder="Enter command" required>
                <label>
                    <input type="checkbox" name="checkbox"> Is this a YouTube link?
                </label>
                <button type="submit" class="confirm">Submit</button>
                <button type="button" class="cancel" onclick="closePopup('add-popup')">Cancel</button>
            </form>
        </div>
    </div>
    <div class="popup-overlay" id="delete-popup">
        <div class="popup">
            <p id="delete-text"></p>
            <button class="confirm" onclick="confirmDelete()">Yes, Delete</button>
            <button class="cancel" onclick="closePopup('delete-popup')">Cancel</button>
        </div>
    </div>

    <div class="popup-overlay" id="show-popup">
        <div class="popup">
            <p id="command-text"></p>
            <button class="cancel" onclick="closePopup('show-popup')">Close</button>
        </div>
    </div>
    <script>
function toggleDropdown(event) {
    event.stopPropagation();
    const dropdown = event.currentTarget;
    const arrow = dropdown.querySelector('.arrow');
    const dropdownContent = dropdown.querySelector('.dropdown-content');

    if (dropdown.classList.contains('active')) {
        dropdown.classList.remove('active');
        arrow.classList.remove('rotated');
    } else {
        closeAllDropdowns();
        dropdown.classList.add('active');
        arrow.classList.add('rotated');
    }
}

function closeAllDropdowns() {
    document.querySelectorAll('.dropdown').forEach(dropdown => dropdown.classList.remove('active'));
    document.querySelectorAll('.arrow').forEach(arrow => arrow.classList.remove('rotated'));
}

function openAddPopup() {
    document.getElementById('add-popup').style.display = 'flex';
}

function closePopup(popupId) {
    document.getElementById(popupId).style.display = 'none';
}

function openShowPopup(command) {
    document.getElementById('command-text').innerText = command;
    document.getElementById('show-popup').style.display = 'flex';
}

function showDeleteConfirmation(lineNumber) {
    document.getElementById('delete-text').innerText = `Are you sure you want to delete command #${lineNumber}?`;
    document.getElementById('delete-popup').style.display = 'flex';
}

function confirmDelete() {
    // Implement delete logic here
    alert('Delete confirmed.');
}

function clearAll() {
    if (confirm('Are you sure you want to clear all commands?')) {
        // Redirect to clear endpoint
        window.location.href = '/clear';
    }
}

function createCommand() {
    window.open('/createcmd', '_blank');
}

document.addEventListener('click', closeAllDropdowns);

    </script>
    </body>
</html>
