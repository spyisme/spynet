<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="robots" content="noindex">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



    <link rel="icon" type="image/x-icon" href="/favicon.ico">



    <title>Spy</title>
    <style>
        html, body {

            margin: 0;
            padding: 0;
            zoom: 90%;

        }
        body {
            font-family: Arial, sans-serif;
            background: #15172b;
            color: white;
            text-align: center;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .form-container {
            margin: 20px;
            left: 50%;
        }
        #videoPlayerContainer {
            display: flex;
            align-items: center;
            justify-content: center;
            top: 50%;
            left: 50%;
        }
        iframe {
            border: 0;
            width: 935.18px;
            height: 655px;
        }
        #canvas {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        .banner {
            width: 100%;
            height: 100%;
        }
        .banner_content {
            display: flex;
            position: relative;
            z-index: 1;
            flex-direction: column;
            text-align: center;
        }
        .play-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            margin: 5px;
        }
        .play-btn.clicked {
            background-color: red;
            pointer-events: none;
        }
        h1 {
            color: white;
            font-size: 24px;
        }
        @media only screen and (max-width: 600px) {
            #lectureIdInput {
                width: 100%;
            }
        }
        .custom-select {
            font-family: Arial, sans-serif;
            background-color: whitesmoke;
            border-radius: 10px;

        }
        .pdf-btn{
          background-color: #6e1cda;
            color: white;
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            margin: 5px;
        }
    </style>
    <script>



document.addEventListener('DOMContentLoaded', loadLectures);

function loadLectures() {

  var xhr = new XMLHttpRequest();
    var url = "https://api.csacademyzone.com/lectures";

    xhr.open("POST", url, true);
    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xhr.setRequestHeader("sessionToken", "ss");

    xhr.onreadystatechange = function () {
    if (xhr.readyState === XMLHttpRequest.DONE) {
        if (xhr.status === 401) {
            // Parse JSON response
            var data = JSON.parse(xhr.responseText);

            // Initialize array for filtered lectures
            var filteredLectures = [];

            // Iterate over lectures in the response data
            data.lectures.forEach(function (lecture) {
                var filteredLecture = {
                    "id": lecture.id,
                    "title": lecture.title
                };

                // Check for video parts using ASCII lowercase letters
                for (var i = 0; i < 26; i++) {
                    var partKey = "part_" + String.fromCharCode(97 + i) + "_video";
                    if (lecture.hasOwnProperty(partKey) && lecture[partKey]) {
                        filteredLecture[partKey] = lecture[partKey];
                    }
                }

                // Check for PDF link
                if (lecture.hasOwnProperty('pdf') && lecture.pdf) {
                    filteredLecture['pdf'] = lecture.pdf;
                }

                // Push filtered lecture into array
                filteredLectures.push(filteredLecture);
            });

            // Prepare result object
            var lectures = {
                "filtered_lectures": filteredLectures
            };
            console.log("Filtered Lectures:", lectures.filtered_lectures);



        populateLectureDropdown(lectures.filtered_lectures);
        populateParts(lectures.filtered_lectures[0]); // Initialize with the first lecture's parts




        } else {
            console.error('Request failed. Status:', xhr.status);
        }
    }
};

    xhr.send();


}

function populateLectureDropdown(filteredLectures) {
    var lectureDropdown = document.getElementById("lectureIdInput");
    if (!lectureDropdown) {
        console.error('Lecture dropdown element not found');
        return;
    }
    lectureDropdown.innerHTML = ''; // Clear any existing options

    filteredLectures.forEach((lecture) => {
        var option = document.createElement('option');
        option.value = lecture.id;
        option.textContent = lecture.title;
        lectureDropdown.appendChild(option);
    });

    lectureDropdown.addEventListener('change', function () {
        const selectedLecture = filteredLectures.find(lecture => lecture.id === this.value);
        populateParts(selectedLecture);
    });
}

function populateParts(lecture) {
    var playButtonContainer = document.getElementById("playButtonContainer");
    var videoPlayer = document.getElementById("videoPlayer");
    if (!playButtonContainer || !videoPlayer) {
        console.error('Parts container or video player element not found');
        return;
    }
    playButtonContainer.innerHTML = ''; // Clear any existing parts

    Object.keys(lecture).forEach(key => {
        if (key.startsWith('part_') && key.endsWith('_video')) {
            var partLetter = key.charAt(5).toUpperCase();
            var playButton = document.createElement('button');
            playButton.className = 'play-btn';
            playButton.textContent = `Play Part ${partLetter}`;
            playButton.id = key;
            playButton.addEventListener('click', function () {
                loadVideo(lecture[key], key);
            });
            playButtonContainer.appendChild(playButton);
        }
    });

    if (lecture.pdf) {
        var pdfButton = document.createElement('button');
        pdfButton.className = 'pdf-btn';
        pdfButton.textContent = 'Open PDF';
        pdfButton.id = 'pdfButton';
        pdfButton.addEventListener('click', function () {
            window.open("https://csacademyzone-pdfs.s3.eu-central-1.amazonaws.com/" + lecture.pdf, '_blank');
        });
        playButtonContainer.appendChild(pdfButton);
    }

    document.querySelector('h3').innerText = `${lecture.title}`;
    document.querySelector('h1').innerText = 'Click a part to play!';
    document.getElementById('videoPlayer').src = '';
}

function loadVideo(videoId, partId) {
    var videoPlayer = document.getElementById("videoPlayer");

    var xhr = new XMLHttpRequest();
    var url = "https://api.csacademyzone.com/video/otp";

    xhr.open("POST", url, true);
    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xhr.setRequestHeader("Referer", "https://csacademyzone.com/");
    xhr.setRequestHeader("sec-fetch-dest", "empty");
    xhr.setRequestHeader("sec-fetch-mode", "cors");
    xhr.setRequestHeader("sessionToken", "ss");

    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            var response = JSON.parse(xhr.responseText);
            var otp = response.otp;
            var playbackInfo = response.playbackInfo;

            videoPlayer.src = `https://player.vdocipher.com/v2/?otp=${otp}&playbackInfo=${playbackInfo}`;
        }
    };

    var data = JSON.stringify({
        'student_name': 'ss',
        'video_id': videoId
    });

    xhr.send(data);

    var partLetter = partId.charAt(5).toUpperCase();
    document.querySelector('h1').innerText = `Lecture ${document.getElementById("lectureIdInput").value} Part ${partLetter}`;

    var allButtons = document.querySelectorAll(".play-btn");
    allButtons.forEach(button => {
        button.classList.remove("clicked");
    });

    var clickedButton = document.getElementById(partId);
    if (clickedButton) {
        clickedButton.classList.add("clicked");
    }
}
</script>

</head>
<body>




    <section class="banner">
        <canvas id="canvas"></canvas>
        <div class="form-container">
            <h2>Ashraf ElShenawy (By Spy)</h2>
            <h3></h3>
            <label for="lectureIdInput">Select Lecture :</label>
            <select class="custom-select" id="lectureIdInput"></select>
            <br>
        </div>
        <h1></h1>
        <div id="playButtonContainer"></div>
        <br><br>
        <div id="videoPlayerContainer">
            <iframe id="videoPlayer" allow="encrypted-media" allowfullscreen></iframe>
        </div>
    </section>





</body>

<script>
const SNOW_COUNT = 400;

    function startAnimation() {
      const CANVAS_WIDTH = window.innerWidth;
      const CANVAS_HEIGHT = window.innerHeight;
      const MIN = 0;
      const MAX = CANVAS_WIDTH;

      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");

      canvas.width = CANVAS_WIDTH;
      canvas.height = CANVAS_HEIGHT;

      function clamp(number, min = MIN, max = MAX) {
        return Math.max(min, Math.min(number, max));
      }

      function random(factor = 1) {
        return Math.random() * factor;
      }

      function degreeToRadian(deg) {
        return deg * (Math.PI / 180);
      }

      // All the properties for Circle
      class Circle {
        radius = 0;
        x = 0;
        y = 0;
        vx = 0;
        vy = 0;

        constructor(ctx) {
          this.ctx = ctx;
          this.reset();
        }

        draw() {
          this.ctx.beginPath();
        // Get the body element
    const body = document.body;

    // Get the computed background color of the body
    const bodyBgColor = window.getComputedStyle(body).backgroundColor;

    // Check if the background color is light or dark
    if (bodyBgColor === 'rgb(240, 240, 240)' || bodyBgColor === '#f0f0f0') {
        // Light mode: set fill style to white
        ctx.fillStyle = 'rgba(255, 0, 0, 0.8)';

    } else {
        // Dark mode: set fill style to red
        ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
    }

          this.ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
          this.ctx.fill();
          this.ctx.closePath();
        }

        reset() {
        this.radius = random(2.5);
        this.x = random(CANVAS_WIDTH);
        this.y = this.y ? 0 : random(CANVAS_HEIGHT);
        this.vx = clamp((Math.random() - 0.5) * 0.4, -0.4, 0.4);
          this.vy = clamp(random(1.5), 0.1, 0.8) * this.radius * 0.5;
    }
      }

      // Array for storing all the generated circles
      let circles = [];

      // Generate circles
      for (let i = 0; i < SNOW_COUNT; i++) {
        circles.push(new Circle(ctx));
      }

      // Clear canvas
      function clearCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }

      // start and end cordinates of canvas
      let canvasOffset = {
        x0: ctx.canvas.offsetLeft,
        y0: ctx.canvas.offsetTop,
        x1: ctx.canvas.offsetLeft + ctx.canvas.width,
        y1: ctx.canvas.offsetTop + ctx.canvas.height
      };

      function animate() {
        clearCanvas();

        circles.forEach((e) => {
          // reset the circle if it collides on border
          if (
            e.x <= canvasOffset.x0 ||
            e.x >= canvasOffset.x1 ||
            e.y <= canvasOffset.y0 ||
            e.y >= canvasOffset.y1
          ) {
            e.reset();
          }

          // Drawing path using polar cordinates
          e.x = e.x + e.vx;
          e.y = e.y + e.vy;
          e.draw();
        });

        requestAnimationFrame(animate);
      }

      animate();
    }

    startAnimation();

    window.addEventListener("resize", startAnimation);

    </script>


</html>