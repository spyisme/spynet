<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}" />

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>
      <script src="{{ url_for('static', filename='java/connection.js') }}"></script>

    <title>Spy</title>

      <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/ashraf.css') }}">
    


      <style>
        /* CSS to make the dropdown font size bigger */
        select {
            font-size: 18px; /* Adjust this value for bigger font */
            padding: 5px; /* Optional: to increase the size of the dropdown box */
        }

        #results {
    font-size: 18px; /* Increase the font size */
    line-height: 1.6; /* Adjust the line spacing, higher value = more space */
    padding: 10px; /* Optional: add padding for better spacing inside the container */
    margin-top: 20px; /* Optional: space between the results container and other elements */
    border-radius: 5px; /* Optional: rounded corners */
}

.result-item {
            margin: 5px 0; /* Space between result items */
        }
        .result-item a {
            text-decoration: none; /* Remove underline from links */
            color: #007bff; /* Link color */
        }
        .result-item a:hover {
            text-decoration: underline; /* Underline on hover */
        }    

        .iframe-container {
            margin-top: 20px;
            display: none; /* Initially hide the iframe container */
        }
        iframe {
            width: 100%;
            height: 600px; /* Adjust height as needed */
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>

</head>
<body onload="startCountdown()">

    <section class="banner">
        <canvas id="canvas"></canvas>
        <div class="form-container">
            <p style="font-size: 43px;">The leader (By Spy)</p>

            <p>
                <a href="/" class="nohover">Home</a>
              </p><br>
            <hr>

            <select name="dropdown" id="dropdown" onchange="loadlec()">

   {%for x in lectures%}
   <option value="{{ x }}">{{ x }}</option>

   {% endfor %}

</select>



<div id="results" class="result-container"></div>

<div class="iframe-container" id="iframeContainer">
    <iframe id="contentFrame" src="" allowfullscreen></iframe>
</div>
        <br>      
        <br>
        <br>
        <br>
        <br>
        <br>
          <div class="footer">
            <p id="countdown">Â© 2024 Sanawya sessions</p>
          </div>

        
    </section>

</body>
<script>
async function loadlec() {
    var selectedOption = document.getElementById('dropdown').value;
    var idMatch = selectedOption.match(/ID\s*:\s*(\d+)/);

    // Get the necessary elements
    var resultsContainer = document.getElementById('results');
    var iframeContainer = document.getElementById('iframeContainer');
    var contentFrame = document.getElementById('contentFrame');

    // Clear the results and iframe and show loading messages
    resultsContainer.innerHTML = 'Loading...';
    contentFrame.src = ''; // Clear the iframe content
    document.getElementById('contentFrame').src = '';
    iframeContainer.style.display = 'none'; // Hide the iframe

    if (idMatch) {
        var id = idMatch[1];
        var url = "/subjects/english/theleader/session/" + id;

        try {
            let response = await fetch(url);

            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }

            let data = await response.json();
            displayResults(data);
        } catch (error) {
            console.error('There was a problem with the fetch operation:', error);
            resultsContainer.innerHTML = 'Error loading content. Please try again later.';
        }
    } else {
        alert("ID not found in the selected option!");
        resultsContainer.innerHTML = ''; // Clear loading message if no ID found
    }
}

function displayResults(data) {
    var resultsContainer = document.getElementById('results');
    var iframeContainer = document.getElementById('iframeContainer');
    var contentFrame = document.getElementById('contentFrame');

    // Clear the existing results
    resultsContainer.innerHTML = '';

    // Display the results from the data
    data.forEach(function(item) {
        let id = item[0];
        let description = item[1];
        let type = item[2];

        // Construct the URL based on the type
        let url = "";
        if (type === "video") {
            url = "/subjects/english/theleader/session/video/" + id;
        } else if (type === "webcontent") {
            url = "/subjects/english/theleader/session/webcontent/" + id;
        } else if (type === "document") {
            url = "/subjects/english/theleader/session/document/" + id;
        }

        // Create a clickable link
        let itemDiv = document.createElement('div');
        itemDiv.className = 'result-item';

        // Check the type and create link accordingly
        if (type === "video") {
            itemDiv.innerHTML = `<a href="javascript:void(0);" onclick="updateIframe('${url}', 'video')"><strong>${description}</strong> (${type})</a>`;
        } else {
            itemDiv.innerHTML = `<a href="${url}" target="_blank"><strong>${description}</strong> (${type})</a>`;
        }

        resultsContainer.appendChild(itemDiv);
    });

    iframeContainer.style.display = 'none'; // Keep the iframe hidden until a video is selected
}

async function updateIframe(url, type) {
    var iframeContainer = document.getElementById('iframeContainer');

    // Remove existing iframe if it exists
    var existingIframe = document.getElementById('contentFrame');
    if (existingIframe) {
        iframeContainer.removeChild(existingIframe);
    }

    // Create a new iframe element
    var contentFrame = document.createElement('iframe');
    contentFrame.id = 'contentFrame'; // Set the id for the new iframe
    contentFrame.allowfullscreen = true; // Allow fullscreen mode
    contentFrame.style.width = '100%'; // Set width
    contentFrame.style.height = '600px'; // Set height
    contentFrame.style.border = '1px solid #ddd'; // Set border
    contentFrame.style.borderRadius = '5px'; // Set border radius

    // Show loading message
    var loadingMessage = document.createElement('div');
    loadingMessage.style.fontSize = '24px';
    loadingMessage.style.color = 'gray';
    loadingMessage.style.textAlign = 'center';
    loadingMessage.style.padding = '50px';
    loadingMessage.innerText = 'Loading...';
    
    // Clear iframe container and show loading message
    iframeContainer.innerHTML = ''; // Clear the container
    iframeContainer.appendChild(loadingMessage); // Add loading message

    if (type === 'video') {
        try {
            // Fetch the content from the URL
            let response = await fetch(url);
            
            if (!response.ok) {
                throw new Error('Network response was not ok ' + response.statusText);
            }

            let data = await response.text(); // Get the response as text

            // Set the fetched content into the new iframe using srcdoc
            contentFrame.srcdoc = data;

            // Append the new iframe to the container
            iframeContainer.innerHTML = ''; // Clear previous content
            iframeContainer.appendChild(contentFrame); // Add new iframe

        } catch (error) {
            console.error('There was a problem with the fetch operation:', error);
            loadingMessage.innerText = 'Error loading content. Please try again later.';
            loadingMessage.style.color = 'red'; // Change color to red for error message
        }
    } else {
        // For non-video types, directly set the iframe src and append it
        contentFrame.src = url; // Set the src for the iframe
        iframeContainer.appendChild(contentFrame); // Add new iframe
    }

    // Display the iframe container if a video is loaded
    if (type === 'video') {
        iframeContainer.style.display = 'block';
    } else {
        iframeContainer.style.display = 'none'; // Hide the container for non-video types
    }
}


</script>


    <script src="{{ url_for('static', filename='java/snow.js') }}"></script>
    <script src="   {{ url_for('static', filename='java/countdown.js') }}"></script>
    <script src="   {{ url_for('static', filename='java/connection.js') }}"></script>


</html>