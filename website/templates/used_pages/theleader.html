<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}" />

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>

      <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>
      <script src="{{ url_for('static', filename='java/connection.js') }}"></script>

    <title>Spy</title>

      <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/ashraf.css') }}">
    


      <style>
        /* CSS to make the dropdown font size bigger */
        select {
            font-size: 18px; /* Adjust this value for bigger font */
            padding: 5px; /* Optional: to increase the size of the dropdown box */
        }

        #results {
    font-size: 18px; /* Increase the font size */
    line-height: 1.6; /* Adjust the line spacing, higher value = more space */
    padding: 10px; /* Optional: add padding for better spacing inside the container */
    margin-top: 20px; /* Optional: space between the results container and other elements */
    border-radius: 5px; /* Optional: rounded corners */
}

.result-item {
            margin: 5px 0; /* Space between result items */
        }
        .result-item a {
            text-decoration: none; /* Remove underline from links */
            color: #007bff; /* Link color */
        }
        .result-item a:hover {
            text-decoration: underline; /* Underline on hover */
        }    

        .iframe-container {
            margin-top: 20px;
            display: none; /* Initially hide the iframe container */
        }
        iframe {
            width: 100%;
            height: 600px; /* Adjust height as needed */
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>

</head>
<body onload="startCountdown(); loadlec();">


    <section class="banner">
        <canvas id="canvas"></canvas>
        <div class="form-container">
            <p style="font-size: 43px;">The leader (By Spy)</p>

            <p>
                <a href="/" class="nohover">Home</a>
              </p><br>
            <hr>

            <select name="dropdown" id="dropdown" onchange="loadlec()">

   {%for x in lectures%}
   <option value="{{ x }}">{{ x }}</option>

   {% endfor %}

</select>



<div id="results" class="result-container"></div>

<div class="iframe-container" id="iframeContainer">
    <iframe id="contentFrame" src="" allowfullscreen></iframe>
</div>
        <br>      
        <br>
        <br>
        <br>
        <br>
        <br>
          <div class="footer">
            <p id="countdown">Â© 2024 Sanawya sessions</p>
          </div>

        
    </section>

</body>
<script>
    async function loadlec() {
        var selectedOption = document.getElementById('dropdown').value;
        var idMatch = selectedOption.match(/ID\s*:\s*(\d+)/);

        var resultsContainer = document.getElementById('results');
        var iframeContainer = document.getElementById('iframeContainer');
        var contentFrame = document.getElementById('contentFrame');

        // Clear old content and show loading message in results
        resultsContainer.innerHTML = 'Loading...';
        contentFrame.src = ''; // Clear the iframe content
        iframeContainer.style.display = 'none'; // Hide iframe initially

        if (idMatch) {
            var id = idMatch[1];
            var url = "/subjects/english/theleader/session/" + id;

            try {
                let response = await fetch(url);

                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }

                let data = await response.json();
                displayResults(data);
            } catch (error) {
                console.error('There was a problem with the fetch operation:', error);
                resultsContainer.innerHTML = 'Error loading content. Please try again later.';
            }
        } else {
            alert("ID not found in the selected option!");
            resultsContainer.innerHTML = ''; // Clear loading message if no ID found
        }
    }

    function displayResults(data) {
        var resultsContainer = document.getElementById('results');
        var iframeContainer = document.getElementById('iframeContainer');
        var contentFrame = document.getElementById('contentFrame');

        resultsContainer.innerHTML = ''; // Clear existing results

        data.forEach(function(item) {
            let id = item[0];
            let description = item[1];
            let type = item[2];

            // Construct the URL based on the type
            let url = "";
            if (type === "video") {
                url = "/subjects/english/theleader/session/video/" + id;
            } else if (type === "webcontent") {
                url = "/subjects/english/theleader/session/webcontent/" + id;
            } else if (type === "document") {
                url = "/subjects/english/theleader/session/document/" + id;
            }

            // Create a clickable link
            let itemDiv = document.createElement('div');
            itemDiv.className = 'result-item';

            // Check the type and create link accordingly
            if (type === "video") {
                itemDiv.innerHTML = `<a href="javascript:void(0);" onclick="updateIframe('${url}', 'video')"><strong>${description}</strong> (${type})</a>`;
            } else {
                itemDiv.innerHTML = `<a href="${url}" target="_blank"><strong>${description}</strong> (${type})</a>`;
            }

            resultsContainer.appendChild(itemDiv);
        });

        iframeContainer.style.display = 'block'; // Show iframe after results are loaded
    }
    function updateIframe(url, type) {
    var contentFrame = document.getElementById('contentFrame');
    var iframeContainer = document.getElementById('iframeContainer');

    // Show a loading message inside the iframe initially
    contentFrame.srcdoc = '<div style="font-size: 24px; color: gray; text-align: center; padding: 50px;">Loading...</div>';

    // Listen for when the iframe has finished loading
    contentFrame.onload = function() {
        // Once the content has loaded, clear the srcdoc to avoid any confusion
        contentFrame.srcdoc = '';
    };

    // Update the iframe's src with the actual content URL
    contentFrame.src = url;

    // Display the iframe container
    iframeContainer.style.display = 'block';
}
</script>



    <script src="{{ url_for('static', filename='java/snow.js') }}"></script>
    <script src="   {{ url_for('static', filename='java/countdown.js') }}"></script>
    <script src="   {{ url_for('static', filename='java/connection.js') }}"></script>


</html>